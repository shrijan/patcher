import{j as e,C as y,r as u,c as S,a as F,R as b,l as C}from"./devextreme-license-BOLHMBAL.js";import{T as R,F as E,R as I,S as D,a as T,C as h,D as k,b as v,P as A,c as M,d as N,e as l,B as P,n as B,f as V}from"./button-BveHU-eQ.js";function O({currentFolder:a,dataSource:r,folderFilterExpression:o,folders:i,setCurrentFolder:t,setFolderFilterExpression:s}){const d=n=>{if(!n.dropInsideItem)return;const j=a,p=n.itemData.id,w=n.component.getKeyByRowIndex(n.toIndex);r.update(p,{mediaId:p,targetFolderId:w}),setTimeout(()=>{t("")},300),setTimeout(()=>{t(j)},500)},c=n=>{n.cancel=!0},g=n=>{s(n)},x=n=>{t(n.selectedRowsData[0].id)};return e.jsxs(R,{autoExpandAll:!0,dataSource:i,dataStructure:"plain",filterSyncEnabled:!0,filterValue:o,onFilterValueChange:g,onSelectionChanged:x,children:[e.jsx(E,{visible:!0}),e.jsx(I,{allowDropInsideItem:!0,allowReordering:!1,group:"mediaHierarchy",onDragStart:c,onAdd:d,showDragIcons:!1}),e.jsx(D,{mode:"single"}),e.jsx(T,{mode:"none"}),e.jsx(h,{dataField:"weight",dataType:"number",sortOrder:"asc",visible:!1}),e.jsx(h,{dataField:"folder"})]})}function z({dataSource:a,gridFilterExpression:r,setGridFilterExpression:o}){const i=t=>{o(t)};return e.jsxs(k,{allowColumnResizing:!0,columnAutoWidth:!0,columnResizingMode:"widget",dataSource:a,filterSyncEnabled:!0,filterValue:r,onFilterValueChange:i,rowAlternationEnabled:!0,children:[e.jsx(v,{visible:!0}),e.jsx(A,{allowedPageSizes:[10,25,50,100],displayMode:"adaptive",showInfo:!0,showPageSizeSelector:!0,visible:!0}),e.jsx(M,{allowDropInsideItem:!0,allowReordering:!1,group:"mediaHierarchy"}),e.jsx(N,{enabled:!0,storageKey:"mediaHierarchyPageState",type:"localStorage"}),e.jsx(l,{caption:"Title",dataField:"title",cellRender:t=>e.jsx("a",{href:t.data.view,target:"_blank",children:t.data.title})}),e.jsx(l,{caption:"Type",dataField:"type"}),e.jsx(l,{caption:"Author",dataField:"author"}),e.jsx(l,{caption:"Published",dataField:"published",dataType:"boolean",calculateCellValue:t=>t.published??!1}),e.jsx(l,{caption:"Last Updated",dataField:"lastUpdated",dataType:"datetime",format:"d/M/y, h:m a",calculateCellValue:t=>{const s=t.lastUpdated;return s?new Date(s*1e3):null}}),e.jsx(l,{type:"buttons",alignment:"left",caption:"Actions",children:e.jsx(P,{hint:"Edit media",icon:"edit",onClick:t=>window.open(t.row.data.edit,"_blank")})})]})}async function m(a){if(!a.ok){if(a.status===403){const r=await a.json();B({message:r.error,position:{my:"top left",at:"top left",of:"#media-hierarchy-root"}},"error",3e3)}throw Error(a.statusText)}return a}function U({folderId:a}){return new y({key:"id",loadMode:"raw",load:r=>{let o="media-tree/data";return a&&(o+="?folderId="+a),fetch(o).then(m).then(i=>i.json()).catch(()=>{throw"Network error"})},update:(r,o)=>fetch("media-tree/update",{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(m).then(i=>i.json()).catch(()=>{throw"Network error"})})}function $({setFolderFilterExpression:a,setGridFilterExpression:r}){const o=u.useCallback(()=>{a([]),r([])});return e.jsx(V,{onClick:o,text:"Clear all filters",type:"default"})}function G({folders:a}){const[r,o]=u.useState("root"),[i,t]=u.useState([]),[s,d]=u.useState([]),c=U({folderId:r});return e.jsxs(e.Fragment,{children:[e.jsx($,{setFolderFilterExpression:t,setGridFilterExpression:d}),e.jsxs("div",{className:"media-folder-page-wrapper",children:[e.jsx("div",{className:"media-folder-page-folders",children:e.jsx(O,{currentFolder:r,dataSource:c,folderFilterExpression:i,folders:a,setCurrentFolder:o,setFolderFilterExpression:t})}),e.jsx("div",{className:"media-folder-page-grid",children:e.jsx(z,{dataSource:c,gridFilterExpression:s,setGridFilterExpression:d})})]})]})}S({licenseKey:C});const f=document.getElementById("media-hierarchy-root"),H=JSON.parse(f.dataset.folders);F.createRoot(f).render(e.jsx(b.StrictMode,{children:e.jsx(G,{folders:H})}));
