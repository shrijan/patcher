!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.tooltipbuttons=e())}(self,(()=>(()=>{var t={"ckeditor5/src/core.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/engine.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/engine.js")},"ckeditor5/src/ui.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/widget.js":(t,e,o)=>{t.exports=o("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":t=>{"use strict";t.exports=CKEditor5.dll}},e={};function o(i){var n=e[i];if(void 0!==n)return n.exports;var l=e[i]={exports:{}};return t[i](l,l.exports,o),l.exports}o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i={};return(()=>{"use strict";o.d(i,{default:()=>d});var t=o("ckeditor5/src/core.js"),e=o("ckeditor5/src/widget.js"),n=o("ckeditor5/src/engine.js"),l=o("ckeditor5/src/ui.js");class r extends t.Command{execute(t){const e=this.editor.model,o=e.document.selection;this.editor.model.change((i=>{const n=o.getFirstRange(),l=this.extractTooltipFromSelection(o),r=t.tooltip_text;console.log("settings tooltip",t.tooltip_toggle);const s=t.tooltip_toggle?"nsw-toggletip js-toggletip":"nsw-tooltip js-tooltip",a=t.theme,c=t.tooltip_toggle?"true":"false",d={class:s,"data-theme":a,"aria-controls":t.id,"data-title":r,"tooltip-ref":l,title:t.tooltip_toggle?void 0:r,toggle:c},g={id:t.id,class:"nsw-toggletip__element nsw-toggletip__element--"+a,"tooltip-ref":r},u=i.createDocumentFragment();i.createText(l);let p;p=t.tooltip_toggle?i.createElement("buttonsToogleTooltipSpan",d):i.createElement("buttonsTooltipSpan",d),i.append(p,u),e.insertContent(u,n);const m=i.createElement("tooltipDiv",g),b=e.document.getRoot(),f=e.createPositionAt(b,"end");e.insertContent(m,f)}))}refresh(){const t=this.editor.model,e=t.document.selection.getFirstPosition(),o=t.schema.findAllowedParent(e,"buttonsTooltipSpan"),i=t.schema.findAllowedParent(e,"buttonsToogleTooltipSpan"),n=t.schema.findAllowedParent(e,"tooltipDiv");o||i||n?(o&&(this.isEnabled=null!==o),i&&(this.isEnabled=null!==i),n&&(this.isEnabled=null!==n)):console.error("Neither buttonsTooltipSpan nor buttonsToogleTooltipSpan are allowed at this position.")}extractPlainText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}_updateTooltipContent(t,e,o,i){const n=e.createText(i,{"data-tooltip":i});return t.insertContent(n,o)}extractTooltipFromSelection(t){if(t.isCollapsed){const e=t.getFirstPosition();return e?e.textNode&&e.textNode.data:null}if(!t.getFirstRange())return null;const e=Array.from(t.getFirstRange().getItems());if(e.length>1)return null;const o=e[0];return o.is("$text")||o.is("$textProxy")?o.data:null}}class s extends t.Plugin{static get requires(){return[e.Widget,l.Notification,l.ContextualBalloon]}init(){const t=this.editor;t.editing.view.addObserver(n.ClickObserver),this.listenTo(t.editing.view.document,"click",((t,e)=>{const o=e.domTarget;if(o&&(o.classList.contains("nsw-toggletip")||o.classList.contains("nsw-tooltip")||o.classList.contains("nsw-toggletip__element"))){const t=e.target;this._openEditDialog(t,o)}})),this._defineSchema(),this._defineConverters(),this._defineCommands();const o=this.editor.model;this.editor.editing.mapper.on("viewToModelPosition",(0,e.viewToModelPositionOutsideModelElement)(o,(function(t){return t.hasClass("js-toggletip")||t.hasClass("nsw-toggletip__element")})))}_defineSchema(){const t=this.editor.model.schema;t.register("buttonsTooltipSpan",{allowWhere:"$inlineObject",isInline:!0,allowAttributes:["class","tooltip-ref","title","data-theme","aria-controls","data-title","toggle"],isContent:!0}),t.register("buttonsToogleTooltipSpan",{allowWhere:"$inlineObject",isInline:!0,allowAttributes:["class","data-theme","aria-controls","data-title","tooltip-ref","title","toggle"],isContent:!0}),t.register("tooltipDiv",{allowWhere:"$block",isBlock:!0,allowAttributes:["class","id","tooltip-ref"],isContent:!0})}_defineConverters(){const t=this.editor.conversion;function o(t,e){const o=e.createContainerElement("span",{class:t.getAttribute("class"),"tooltip-ref":t.getAttribute("tooltip-ref"),"data-theme":t.getAttribute("data-theme"),"data-title":t.getAttribute("data-title"),"aria-controls":t.getAttribute("aria-controls"),toggle:t.getAttribute("toggle"),title:t.getAttribute("title")}),i=t.getAttribute("tooltip-ref"),n=e.createText(i);return e.insert(e.createPositionAt(o,0),n),o}function i(t,e){const o={class:t.getAttribute("class"),"tooltip-ref":t.getAttribute("tooltip-ref"),"data-theme":t.getAttribute("data-theme"),"data-title":t.getAttribute("data-title"),"aria-controls":t.getAttribute("aria-controls"),toggle:t.getAttribute("toggle")},i=t.getAttribute("title");i&&(o.title=i);const n=e.createContainerElement("span",o),l=t.getAttribute("tooltip-ref"),r=e.createText(l);return e.insert(e.createPositionAt(n,0),r),n}t.for("editingDowncast").elementToElement({model:"buttonsTooltipSpan",view:(t,{writer:i})=>{const n=o(t,i);return(0,e.toWidget)(n,i)}}),t.for("dataDowncast").elementToElement({model:"buttonsTooltipSpan",view:(t,{writer:e})=>o(t,e)}),t.for("upcast").elementToElement({view:{name:"span",classes:"nsw-tooltip"},model:(t,{writer:e})=>{const o={class:t.getAttribute("class"),"tooltip-ref":t.getAttribute("tooltip-ref"),"data-theme":t.getAttribute("data-theme"),"data-title":t.getAttribute("data-title"),toggle:t.getAttribute("toggle"),"aria-controls":t.getAttribute("aria-controls"),title:t.getAttribute("title")};return e.createElement("buttonsTooltipSpan",o)}}),t.for("editingDowncast").elementToElement({model:"buttonsToogleTooltipSpan",view:(t,{writer:o})=>{const n=i(t,o);return(0,e.toWidget)(n,o)}}),t.for("dataDowncast").elementToElement({model:"buttonsToogleTooltipSpan",view:(t,{writer:e})=>i(t,e)}),t.for("upcast").elementToElement({view:{name:"span",classes:"nsw-toggletip"},model:(t,{writer:e})=>{const o={class:t.getAttribute("class"),title:t.getAttribute("title"),"tooltip-ref":t.getAttribute("tooltip-ref"),"data-theme":t.getAttribute("data-theme"),"data-title":t.getAttribute("data-title"),"aria-controls":t.getAttribute("aria-controls"),toggle:t.getAttribute("toggle")};return e.createElement("buttonsToogleTooltipSpan",o)}}),t.for("upcast").elementToElement({view:{name:"div",classes:"tooltip-div"},model:(t,{writer:e})=>{const o={class:t.getAttribute("class"),id:t.getAttribute("id"),"tooltip-ref":t.getAttribute("tooltip-ref")};return e.createElement("tooltipDiv",o)}}),t.for("downcast").elementToElement({model:"tooltipDiv",view:(t,{writer:o})=>{const i=function(t,e){const o=e.createContainerElement("div",{class:t.getAttribute("class"),id:t.getAttribute("id"),"tooltip-ref":t.getAttribute("tooltip-ref")}),i=e.createText(t.getAttribute("tooltip-ref"));return console.log("textNode",i,t.getAttribute("tooltip-ref")),e.insert(e.createPositionAt(o,0),i),o}(t,o);return(0,e.toWidget)(i,o)}})}_defineCommands(){this.editor.commands.add("insertTooltipButtons",new r(this.editor))}_openEditDialog(t,e){const o=this.editor,i=o.model,n=this.editor.config.get("tooltipbuttons"),l=n.openDialog,r=n.dialogSettings;console.log("domTarget",e);const s=e.getAttribute("data-title"),a=e.getAttribute("title"),c=e.getAttribute("data-theme"),d=e.getAttribute("toggle"),g=e.getAttribute("aria-controls"),u=e.getAttribute("tooltip-ref");console.log("tooltipTitle",a,d);let p=s;console.log("tooltipContent",p),l(Drupal.url("tooltip_buttons/dialog")+"?tooltipTheme="+encodeURIComponent(c)+"&tooltipToggle="+encodeURIComponent(d)+"&tooltipContent="+encodeURIComponent(p),(({settings:n})=>{i.change((l=>{const r=o.editing.mapper.toModelElement(t),s=o.editing.view.document.getRoot(),a=(this.findViewElementById(s,g),n.tooltip_toggle?"true":"false"),c=n.tooltip_text;if(r){l.setAttribute("title",c,r),l.setAttribute("data-title",c,r),l.setAttribute("data-theme",n.theme,r),l.setAttribute("toggle",a,r),l.setAttribute("aria-control",e.getAttribute("aria-controls"),r);let s=r.getAttribute("class")||"";s=s.split(" "),n.tooltip_toggle?(s=s.filter((t=>"nsw-tooltip"!==t&&"js-tooltip"!==t)),s.includes("nsw-toggletip")||s.push("nsw-toggletip"),s.includes("js-toggletip")||s.push("js-toggletip")):(s=s.filter((t=>"nsw-toggletip"!==t&&"js-toggletip"!==t)),s.includes("nsw-tooltip")||s.push("nsw-tooltip"),s.includes("js-tooltip")||s.push("js-tooltip")),l.setAttribute("class",s.join(" "),r);const d=i.document.getRoot();for(const t of d.getChildren()){let e;if(t.is("element","tooltipDiv"))e={class:t.getAttribute("class"),id:t.getAttribute("id")};else if(t.is("element","htmlDivParagraph")){const o=t.getAttribute("htmlDivAttributes");e={class:o.classes?.join(" "),id:o?.attributes.id}}if(e?.id===g){l.remove(t),l.appendElement("tooltipDiv",{class:e.class,id:g,"tooltip-ref":c},d);break}}o.editing.view.change((i=>{i.setAttribute("tooltip-ref",u,t),i.setAttribute("data-title",c,t),i.setAttribute("data-theme",n.theme,t),i.setAttribute("toggle",a,t),i.setAttribute("aria-control",e.getAttribute("aria-controls"),t);const l=i.createRangeIn(t);for(const t of l.getItems())i.remove(t);const r=i.createText(u);if(i.insert(i.createPositionAt(t,0),r),"true"==a){const e=o.editing.view.document.getRoot(),i=this.findViewElementById(e,g);if(i){const n=o.editing.mapper.toModelElement(i);console.log("Div container",e,t,i,n)}else console.log("no div container")}}))}}))}),r)}extractPlainText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}_updateTooltipContent(t,e,o,i){const n=e.createText(i,{"data-tooltip":i});return t.insertContent(n,o)}_removeTooltip(t){const e=this.editor.model;e.schema,this.editor.editing.view;e.change((o=>{const i=this.editor.editing.mapper.toModelElement(t);if(i&&i.is("element","buttonsTooltipSpan")||i&&i.is("element","buttonsToogleTooltipSpan")){const t=i.getAttribute("aria-controls"),n=e.document.getRoot();let l=null;for(const e of n.getChildren())if(e.is("element","tooltipDiv")&&e.getAttribute("id")===t){l=e;break}l&&o.remove(l)}const n=o.createRangeOn(i),l=Array.from(n.getItems()).map((t=>t.data)).join("");o.insertText(l,n.start)}))}extractTooltipFromSelection(t){if(t.isCollapsed){const e=t.getFirstPosition();return e?e.textNode&&e.textNode.data:null}if(!t.getFirstRange())return null;const e=Array.from(t.getFirstRange().getItems());if(e.length>1)return null;const o=e[0];return o.is("$text")||o.is("$textProxy")?o.data:null}findViewElementById(t,e){for(const o of t.getChildren()){if(o.is("element")&&o.getAttribute("id")===e)return o;if(o.is("element")){const t=this.findViewElementById(o,e);if(t)return t}}return null}}class a extends t.Plugin{init(){const t=this.editor,e=this.editor.config.get("tooltipbuttons");if(!e)return;const{openDialog:o,dialogSettings:i={}}=e;"function"==typeof o&&t.ui.componentFactory.add("tooltipbuttons",(e=>{const n=t.commands.get("insertTooltipButtons"),r=new l.ButtonView(e);return r.set({label:Drupal.t("Button tooltip"),icon:'\x3c!-- Generated by IcoMoon.io --\x3e\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n<path d="M18 8.016v-2.016h-12v2.016h12zM18 11.016v-2.016h-12v2.016h12zM18 14.016v-2.016h-12v2.016h12zM20.016 2.016q0.797 0 1.383 0.586t0.586 1.383v18l-3.984-3.984h-14.016q-0.797 0-1.383-0.609t-0.586-1.406v-12q0-0.797 0.586-1.383t1.383-0.586h16.031z"></path>\n</svg>\n',tooltip:!0}),r.bind("isOn","isEnabled").to(n,"value","isEnabled"),this.listenTo(r,"execute",(()=>{o(Drupal.url("tooltip_buttons/dialog"),(({settings:e})=>{t.execute("insertTooltipButtons",e)}),i)})),r}))}}class c extends t.Plugin{static get requires(){return[s,a]}static get pluginName(){return"TooltipButtons"}}const d={TooltipButtons:c}})(),i=i.default})()));