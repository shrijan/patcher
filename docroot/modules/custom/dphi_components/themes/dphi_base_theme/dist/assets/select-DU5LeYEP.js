class r{constructor(t){this.element=t,this.select=this.element.querySelector("select"),this.optGroups=this.select&&this.select.getElementsByTagName("optgroup"),this.options=this.select&&this.select.getElementsByTagName("option"),this.selectId=this.select&&this.select.getAttribute("id"),this.trigger=!1,this.dropdown=!1,this.customOptions=!1,this.list=!1,this.allButton=!1,this.arrowIcon=this.element.getElementsByTagName("svg"),this.label=document.querySelector(`[for="${this.selectId}"]`),this.selectedOptCounter=0,this.optionIndex=0,this.noSelectText=this.element.getAttribute("data-select-text")||"Select",this.multiSelectText=this.element.getAttribute("data-multi-select-text")||"{n} items selected",this.nMultiSelect=this.element.getAttribute("data-n-multi-select")||1,this.noUpdateLabel=this.element.getAttribute("data-update-text")&&this.element.getAttribute("data-update-text")==="off",this.insetLabel=this.element.getAttribute("data-inset-label")&&this.element.getAttribute("data-inset-label")==="on",this.hideClass="nsw-display-none",this.showClass="active",this.errorClass="has-error",this.srClass="sr-only",this.prefix="nsw-",this.class="multi-select",this.buttonClass=`${this.class}__button`,this.allButtonClass=`${this.class}__all`,this.listClass=`${this.class}__list`,this.optionClass=`${this.class}__option`,this.dropdownClass=`${this.class}__dropdown`,this.checkboxClass=`${this.class}__checkbox`,this.itemClass=`${this.class}__item`,this.labelClass=`${this.class}__label`,this.termClass=`${this.class}__term`,this.detailsClass=`${this.class}__details`,this.selectClass="form__select",this.checkboxLabelClass="form__checkbox-label",this.checkboxInputClass="form__checkbox-input"}init(){this.select&&(this.element.insertAdjacentHTML("beforeend",this.initButtonSelect()+this.initListSelect()),this.dropdown=this.element.querySelector(`.js-${this.dropdownClass}`),this.trigger=this.element.querySelector(`.js-${this.buttonClass}`),this.customOptions=this.dropdown.querySelectorAll(`.js-${this.optionClass}`),this.list=this.dropdown.querySelector(`.js-${this.listClass}`),this.list.insertAdjacentHTML("afterbegin",this.initAllButton()),this.allButton=this.list.querySelector(`.js-${this.allButtonClass}`),this.select.classList.add(this.hideClass),this.arrowIcon.length>0&&(this.arrowIcon[0].style.display="none"),this.initCustomSelectEvents(),this.updateAllButton())}initCustomSelectEvents(){this.initSelection(),this.trigger.addEventListener("click",t=>{t.preventDefault(),this.toggleCustomSelect(!1)}),this.label&&this.label.addEventListener("click",()=>{this.constructor.moveFocusFn(this.trigger)}),this.dropdown.addEventListener("keydown",t=>{t.key&&t.key.toLowerCase()==="arrowup"?this.keyboardCustomSelect("prev",t):t.key&&t.key.toLowerCase()==="arrowdown"&&this.keyboardCustomSelect("next",t)}),window.addEventListener("keyup",t=>{t.key&&t.key.toLowerCase()==="escape"&&(this.moveFocusToSelectTrigger(),this.toggleCustomSelect("false"))}),window.addEventListener("click",t=>{this.checkCustomSelectClick(t.target)})}toggleCustomSelect(t){let e;if(t?e=t:e=this.trigger.getAttribute("aria-expanded")==="true"?"false":"true",this.trigger.setAttribute("aria-expanded",e),e==="true"){const s=this.getSelectedOption()||this.allButton;this.constructor.moveFocusFn(s);const i=()=>{this.constructor.moveFocusFn(s),this.dropdown.removeEventListener("transitionend",i)};this.dropdown.addEventListener("transitionend",i),this.constructor.trapFocus(this.dropdown),this.placeDropdown()}}placeDropdown(){const{top:t,bottom:e,left:s}=this.trigger.getBoundingClientRect();this.dropdown.classList.toggle(`${this.prefix}${this.dropdownClass}--right`,window.innerWidth<s+this.dropdown.offsetWidth);const i=window.innerHeight-e<t;this.dropdown.classList.toggle(`${this.prefix}${this.dropdownClass}--up`,i);const l=i?t-20:window.innerHeight-e-20,o=Math.ceil(100*l/window.innerHeight);this.dropdown.setAttribute("style",`max-height: ${o}vh;`)}keyboardCustomSelect(t,e){e.preventDefault();const s=[...this.customOptions,this.allButton];let i=s.findIndex(o=>o===document.activeElement.closest(`.js-${this.optionClass}`));i=t==="next"?i+1:i-1,i<0&&(i=s.length-1),i>=s.length&&(i=0);const l=s[i].querySelector(`.js-${this.checkboxClass}`)||this.allButton;this.constructor.moveFocusFn(l)}toggleAllButton(){const t=!this.allButton.classList.contains(this.showClass);this.allButton.classList.toggle(this.showClass,t);const[e,s,i]=this.getOptions();e.forEach(l=>{l.setAttribute("aria-selected","false"),this.selectOption(l)}),i===s&&e.forEach(l=>this.selectOption(l))}initSelection(){this.allButton.addEventListener("click",t=>{t.preventDefault(),this.toggleAllButton()}),this.dropdown.addEventListener("change",t=>{const e=t.target.closest(`.js-${this.optionClass}`);e&&this.selectOption(e)}),this.dropdown.addEventListener("click",t=>{const e=t.target.closest(`.js-${this.optionClass}`);!e||!t.target.classList.contains(`js-${this.optionClass}`)||this.selectOption(e)})}selectOption(t){const e=t.querySelector(`.js-${this.checkboxClass}`);t.hasAttribute("aria-selected")&&t.getAttribute("aria-selected")==="true"?(e.checked=!1,e.removeAttribute("checked"),t.setAttribute("aria-selected","false"),this.updateNativeSelect(t.getAttribute("data-index"),!1)):(e.checked=!0,e.value=!0,e.setAttribute("checked",""),t.setAttribute("aria-selected","true"),this.updateNativeSelect(t.getAttribute("data-index"),!0));const s=this.getSelectedOptionText(),[i]=s;this.trigger.querySelector(`.js-${this.labelClass}`).innerHTML=i,this.trigger.classList.toggle(`${this.prefix}${this.buttonClass}--active`,this.selectedOptCounter>0),this.updateTriggerAria(s[1]),this.updateAllButton()}updateAllButton(){const[,t,e]=this.getOptions();e===t?this.allButton.classList.add(this.showClass):this.allButton.classList.remove(this.showClass)}updateNativeSelect(t,e){this.options[t].selected=e,this.select.dispatchEvent(new CustomEvent("change",{bubbles:!0}))}updateTriggerAria(t){this.trigger.setAttribute("aria-label",t)}getSelectedOptionText(){const t=`<span class="${this.prefix}${this.termClass}">${this.noSelectText}</span>`;if(this.noUpdateLabel)return[t,this.noSelectText];let e="",s="";this.selectedOptCounter=0;for(let i=0;i<this.options.length;i+=1)this.options[i].selected&&(this.selectedOptCounter!==0&&(e+=", "),e=`${e}${this.options[i].text}`,this.selectedOptCounter+=1);return this.selectedOptCounter>this.nMultiSelect?(e=`<span class="${this.prefix}${this.detailsClass}">${this.multiSelectText.replace("{n}",this.selectedOptCounter)}</span>`,s=`${this.multiSelectText.replace("{n}",this.selectedOptCounter)}, ${this.noSelectText}`):this.selectedOptCounter>0?(s=`${e}, ${this.noSelectText}`,e=`<span class="${this.prefix}${this.detailsClass}">${e}</span>`):(e=t,s=this.noSelectText),this.insetLabel&&this.selectedOptCounter>0&&(e=t+e),[e,s]}initButtonSelect(){const t=this.element.getAttribute("data-trigger-class")?` ${this.element.getAttribute("data-trigger-class")}`:"",e=this.select.getAttribute("aria-invalid"),s=this.getSelectedOptionText(),i=this.selectedOptCounter>0?` ${this.buttonClass}--active`:"";let l=`<button class="js-${this.buttonClass} ${e==="true"?this.errorClass:""} ${this.prefix}${this.selectClass} ${this.prefix}${this.buttonClass}${t}${i}" aria-label="${s[1]}" aria-expanded="false" aria-controls="${this.selectId}-dropdown"><span aria-hidden="true" class="js-${this.labelClass} ${this.prefix}${this.labelClass}">${s[0]}</span><span class="material-icons nsw-material-icons" focusable="false" aria-hidden="true">keyboard_arrow_down</span>`;return this.arrowIcon.length>0&&this.arrowIcon[0].outerHTML&&(l+=this.arrowIcon[0].outerHTML),`${l}</button>`}initListSelect(){let t=`<div class="js-${this.dropdownClass} ${this.prefix}${this.dropdownClass}" aria-describedby="${this.selectId}-description" id="${this.selectId}-dropdown">`;if(t+=this.getSelectLabelSR(),this.optGroups.length>0)for(let e=0;e<this.optGroups.length;e+=1){const s=this.optGroups[e].getElementsByTagName("option"),i=`<li><span class="${this.prefix}${this.itemClass} ${this.prefix}${this.itemClass}--optgroup">${this.optGroups[e].getAttribute("label")}</span></li>`;t=`${t}<ul class="${this.prefix}${this.listClass}" role="listbox" aria-multiselectable="true">${i}${this.getOptionsList(s)}</ul>`}else t=`${t}<ul class="${this.prefix}${this.listClass} js-${this.listClass}" role="listbox" aria-multiselectable="true">${this.getOptionsList(this.options)}</ul>`;return t}initAllButton(){return`<button class="${this.prefix}${this.allButtonClass} js-${this.allButtonClass}"><span>All</span></button>`}getSelectLabelSR(){return this.label?`<p class="${this.srClass}" id="${this.selectId}-description">${this.label.textContent}</p>`:""}getOptionsList(t){let e="";for(let s=0;s<t.length;s+=1){const i=t[s].hasAttribute("selected")?' aria-selected="true"':' aria-selected="false"',l=t[s].hasAttribute("disabled")?"disabled":"",o=t[s].hasAttribute("selected")?"checked":"",a=this.constructor.createSafeCss(`${this.selectId}-${t[s].value}-${this.optionIndex.toString()}`);e=`${e}<li class="js-${this.optionClass}" role="option" data-value="${t[s].value}" ${i} data-label="${t[s].text}" data-index="${this.optionIndex}"><input aria-hidden="true" class="${this.prefix}${this.checkboxInputClass} js-${this.checkboxClass}" type="checkbox" id="${a}" ${o} ${l}><label class="${this.prefix}${this.checkboxLabelClass} ${this.prefix}${this.itemClass} ${this.prefix}${this.itemClass}--option" aria-hidden="true" for="${a}"><span>${t[s].text}</span></label></li>`,this.optionIndex+=1}return e}getSelectedOption(){const t=this.dropdown.querySelector('[aria-selected="true"]');return t?t.querySelector(`.js-${this.checkboxClass}`):this.allButton}getOptions(){const t=Array.from(this.dropdown.querySelectorAll(`.js-${this.optionClass}`)),e=t.length,s=t.filter(i=>i.getAttribute("aria-selected")==="true").length;return[t,e,s]}moveFocusToSelectTrigger(){document.activeElement.closest(`.js-${this.class}`)&&this.trigger.focus()}static trapFocus(t){const e='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])',s=t.querySelectorAll(e)[0],i=t.querySelectorAll(e),l=i[i.length-1];document.addEventListener("keydown",o=>{(o.key==="Tab"||o.code===9)&&(o.shiftKey?document.activeElement===s&&(l.focus(),o.preventDefault()):document.activeElement===l&&(s.focus(),o.preventDefault()))}),s.focus()}checkCustomSelectClick(t){this.element.contains(t)||this.toggleCustomSelect("false")}static createSafeCss(t){const e=/^([0-9]|--|-[0-9])/;if(typeof t!="string")return"";const s=t.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g).map(i=>i.toLowerCase()).join("-");return e.test(s)?`_${s}`:s}static moveFocusFn(t){t.focus(),document.activeElement!==t&&(t.setAttribute("tabindex","-1"),t.focus())}}export{r as S};
