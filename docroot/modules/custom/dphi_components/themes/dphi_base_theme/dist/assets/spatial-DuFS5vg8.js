import{S as P}from"./select-DU5LeYEP.js";Drupal.behaviors.spatial={attach:()=>{once("spatial",".spatial").forEach(p=>{var M,T;const h=p.querySelector(".mapboxgl-map"),c=h?JSON.parse(h.dataset.mapbox):{},a=c.geojson,x=c.clustering,w=window.getComputedStyle(document.body),y={blue:w.getPropertyValue("--nsw-focus-light"),red:w.getPropertyValue("--nsw-brand-accent"),dark:w.getPropertyValue("--nsw-brand-dark"),supplementary:w.getPropertyValue("--nsw-brand-supplementary")},E=n=>'<svg xmlns="http://www.w3.org/2000/svg" height="41px" width="27px" viewBox="0 0 27 41"><defs><radialGradient id="shadowGradient"><stop offset="10%" stop-opacity="0.4"></stop><stop offset="100%" stop-opacity="0.05"></stop></radialGradient></defs><ellipse cx="13.5" cy="34.8" rx="10.5" ry="5.25" fill="url(#shadowGradient)"></ellipse><path fill="'+(y[n]||Object.values(y)[0])+'" d="M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"></path><path opacity="0.25" d="M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"></path><circle fill="white" cx="13.5" cy="13.5" r="5.5"></circle></svg>',S=h?h.dataset.type:null;if(S=="gmap"){const n={lat:-33.81,lng:151.25};google.maps.importLibrary("maps").then(o=>{var r,i;const s=new o.Map(document.getElementById("spatialmap"),{zoom:parseInt(a.zoom),center:n}),t=[],l=[],d=new google.maps.LatLngBounds;if(a.features.forEach(e=>{if(e.properties.Latitude===null||e.properties.Longitude===null)return;const m={lat:parseFloat(e.properties.Latitude),lng:parseFloat(e.properties.Longitude)};d.extend(m);const g=new google.maps.Marker({position:m,title:e.properties.title,id:e.properties.id,icon:"data:image/svg+xml;charset=UTF-8;base64,"+btoa(E(e.properties.color))});g.metadata={type:"point",id:e.properties.id},x!=1&&g.setMap(s);let f=e.properties.description.replace(/\n/g,"<br/>");window.innerWidth<=576&&f.length>100&&(f=e.properties.description.slice(0,100)+"...",f=f.replace(/\n/g,"<br/>"));let b="<b>";e.properties.link?b+='<a href="'+e.properties.link+'">':b+="<p>",b+=e.properties.title,b+=e.properties.link?"</a>":"</p>",b+="</b><p>"+f+"</p>";const L=new google.maps.InfoWindow({content:b,ariaLabel:e.properties.title,disableAutoPan:!0,maxWidth:300});l.push(L),g.addListener("click",()=>{const _=g.getPosition();s.setCenter(_),s.panTo(_),l.forEach(q=>{q.close(s,g)}),L.open(s,g)}),s.addListener("click",()=>{L&&L.close()}),t.push(g)}),c.defaultConfig)s.setCenter(n),s.setZoom(parseInt(a.zoom));else if(a.features.length>1)s.fitBounds(d);else if(a.features.length==1){const e=a.features[0].properties;e.Latitude!==null&&e.Longitude!==null&&s.setCenter({lat:parseFloat(e.Latitude),lng:parseFloat(e.Longitude)}),s.setZoom(16)}x==1&&new markerClusterer.MarkerClusterer({markers:t,map:s});const u=p.querySelectorAll(".nsw-list-item");u.forEach(e=>{e.addEventListener("click",m=>{if(m.target.closest("a"))return;m.preventDefault(),u.forEach(b=>{b.querySelector(".nsw-list-item__content").classList.remove("highlighted")}),e.querySelector(".nsw-list-item__content").classList.add("clicked","highlighted");const g=c.plot_method=="postcode"?"p":"",f={lat:parseFloat(e.dataset[g+"lng"]),lng:parseFloat(e.dataset[g+"lat"])};s.setCenter(f),s.panTo(f),s.setZoom(12)})}),(r=p.querySelector("#searchPageFiltersTop #edit-map-reset"))==null||r.addEventListener("click",e=>{e.preventDefault(),s.setCenter(n),s.panTo(n),s.setZoom(parseInt(a.zoom))}),(i=p.querySelector("#searchPageFilters #edit-map-reset"))==null||i.addEventListener("click",e=>{e.preventDefault(),s.setCenter(n),s.panTo(n),s.setZoom(parseInt(a.zoom))})})}else if(S=="mapbox"){mapboxgl.accessToken=c.token;const n=[151.25,-33.81],o=new mapboxgl.Map({container:"spatialmap",style:c.style,zoom:a.zoom,center:n,attributionControl:!1});o.addControl(new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),o.addControl(new mapboxgl.NavigationControl),o.on("load",()=>{if(x!=1)a.features.forEach(t=>{let l="";if(t.properties.type=="eepa_provider")l=new mapboxgl.Popup({offset:25}).setHTML("<p><b>Organisation:</b> "+t.properties.organisation+", </p><p><b>Address:</b> "+t.properties.address+", "+t.properties.suburb+"</p><p><b>Phone:</b> "+t.properties.phone+"</p>");else if(t.properties.type=="ev_charging_station")l=new mapboxgl.Popup({offset:25}).setHTML("<p>"+t.properties.address+"<p>"+t.properties.level+"</p>");else if(t.properties.type=="spatial_component"){let u=t.properties.description.replace(/\n/g,"<br/>");window.innerWidth<=576&&u.length>100&&(u=t.properties.description.slice(0,100)+"...",u=u.replace(/\n/g,"<br/>"));let r="<b>";t.properties.link?r+='<a href="'+t.properties.link+'">':r+="<p>",r+=t.properties.title,r+=t.properties.link?"</a>":"</p>",r+="</b><p>"+u+"</p>",l=new mapboxgl.Popup({offset:25}).setHTML(r)}const d=document.createElement("div");d.className="marker-icon",d.innerHTML=E(t.properties.color),d.id=t.properties.id,d.addEventListener("focus",()=>{o.setCenter(t.geometry.coordinates)}),new mapboxgl.Marker(d).setLngLat(t.geometry.coordinates).setPopup(l).addTo(o)});else{o.addSource("markers",{type:"geojson",data:{type:"FeatureCollection",features:a.features},cluster:!0,clusterMaxZoom:14,clusterRadius:50}),o.addLayer({id:"clusters",type:"circle",source:"markers",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],y.supplementary,5,y.supplementary,10,y.supplementary],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}});const t=w.getPropertyValue("--nsw-text-dark");o.addLayer({id:"cluster-count",type:"symbol",source:"markers",filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":t}}),o.addLayer({id:"unclustered-point",type:"circle",source:"markers",filter:["!",["has","point_count"]],paint:{"circle-color":["match",["get","color"],"blue",y.supplementary,"red",y.red,y.supplementary],"circle-radius":10,"circle-stroke-width":1,"circle-stroke-color":y.supplementary}});const l=r=>{const i=r.properties.cluster_id;o.getSource("markers").getClusterExpansionZoom(i,(e,m)=>{e||o.easeTo({center:r.geometry.coordinates,zoom:m})})};o.on("click","clusters",r=>{const i=o.queryRenderedFeatures(r.point,{layers:["clusters"]});l(i[0])});const d=(r,i)=>{const e=r.geometry.coordinates.slice(),m=r.properties.title,g=r.properties.link,f=r.properties.description;if(i!==void 0)for(;Math.abs(i.lng-e[0])>180;)e[0]+=i.lng>e[0]?360:-360;new mapboxgl.Popup({offset:10}).setLngLat(e).setHTML('<b><a href="'+g+'">'+m+"</a></b><p>"+f+"</p>").addTo(o)};o.on("click","unclustered-point",r=>{d(r.features[0],r.lngLat)});let u=[];o.on("render",()=>{let r=o.queryRenderedFeatures({layers:["clusters","unclustered-point"]});r=[...new Map(r.map(i=>[i.id!==void 0?i.id:i.properties.id,i])).values()],u.forEach(i=>{i.remove()}),u=r.map(i=>{const e=document.createElement("div"),m=(i.layer.paint["circle-radius"]*2).toString()+"px";return e.style.width=m,e.style.height=m,e.tabIndex=0,e.addEventListener("keydown",g=>{g.key=="Enter"&&(i.id!==void 0?l(i):d(i))}),e.addEventListener("focus",()=>{o.setCenter(i.geometry.coordinates)}),new mapboxgl.Marker(e).setLngLat(i.geometry.coordinates).addTo(o)})})}if(c.filtered){const t=[];if(a.features.forEach(l=>{t.push(l.geometry.coordinates)}),c.defaultConfig)o.flyTo({center:n,essential:!0,zoom:a.zoom});else if(t.length>0){const l=t.map(i=>i[1]),d=t.map(i=>i[0]),u=[Math.min.apply(null,d),Math.min.apply(null,l)],r=[Math.max.apply(null,d),Math.max.apply(null,l)];t.length>1?o.fitBounds([u,r],{padding:100}):o.flyTo({center:u,essential:!0,zoom:12})}}});const s=p.querySelectorAll(".nsw-list-item");s.forEach(t=>{t.addEventListener("click",()=>{s.forEach(l=>{l.querySelector(".nsw-list-item__content").classList.remove("highlighted")}),t.querySelector(".nsw-list-item__content").classList.add("clicked","highlighted")})}),(M=p.querySelector("#searchPageFiltersTop #edit-map-reset"))==null||M.addEventListener("click",t=>{t.preventDefault(),o.flyTo({center:n,essential:!0,zoom:a.zoom})}),(T=p.querySelector("#searchPageFilters #edit-map-reset"))==null||T.addEventListener("click",t=>{t.preventDefault(),o.flyTo({center:n,essential:!0,zoom:a.zoom})})}const C=p.querySelector("#searchPageFiltersTop .checkboxes .js-form-type-select");if(C){const n=new P(C);n.init(),n.allButton.remove();const o=document.createElement("li");o.hidden=n.getOptions()[2]==0;const s=document.createElement("a");s.href="javascript:void(0);",s.addEventListener("click",()=>{n.getOptions()[0].forEach(t=>{t.setAttribute("aria-selected","true"),n.selectOption(t)})}),s.innerText="Clear all selections",o.appendChild(s),n.list.appendChild(o),n.updateAllButton=()=>{o.hidden=n.getOptions()[2]==0},C.role="application"}const v=p.querySelector("#search-result-filter .sc-filters-title");v==null||v.addEventListener("click",()=>{v.nextElementSibling.classList.toggle("nsw-display-none")});const k=p.querySelector("#views-exposed-form-sc-list-top");if(k){const n=p.querySelector("#views-exposed-form-spatial-components-block-list");if(n){const o=k.querySelector(".form-text-postcode");o.addEventListener("keyup",()=>{n.querySelector(".form-item-postcode input").value=o.value})}k.querySelector(".form-submit").addEventListener("click",()=>{FormPub.submit()})}}),once("spatial-tab",".sc-tabs").forEach(p=>{const h=localStorage.getItem("map-active-tab");if(h&&h!=p.querySelector("a.active").getAttribute("href")){const c=p.querySelector('a[href="'+h+'"]');c&&c.click()}p.querySelectorAll("a").forEach(c=>{c.addEventListener("click",a=>{a.preventDefault(),localStorage.setItem("map-active-tab",c.getAttribute("href"))})})})}};
